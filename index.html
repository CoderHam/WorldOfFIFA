<!DOCTYPE HTML>
<html>
	<head>
		<title>FIFA 18 Visualization</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	    <link href="assets/css/nouislider.min.css" rel="stylesheet">
	    <link rel="stylesheet" type="text/css" href="assets/js/tooltipster-master/dist/css/tooltipster.bundle.min.css" />
	</head>
	<body>
		<!-- Main -->
			<div id="main">
				<div class="box alt container" id="main_content">
					<img src="white_ff.png" id="field" height="600px" style="margin-left: -60px;"/>
					<img src="/player1_crop.png" class="tooltip" title="Goalkeeper" id="gk" height="100px" style="margin-left: -850px; margin-top: 240px; position: absolute; z-index: 2;"/>
					<img src="/player2_crop.png" class="tooltip" id="def_1" title="Left Back" height="100px" style="margin-left: -650px; margin-top: 50px; position: absolute; z-index: 2;" />
					<img src="/player3_crop.png" class="tooltip" id="def_2" title="Center Back" height="100px" style="margin-left: -650px; margin-top: 180px; position: absolute; z-index: 2;" />
					<img src="/player4_crop.png" class="tooltip" title="Center Back" id="def_3" height="100px" style="margin-left: -650px; margin-top:  310px; position: absolute; z-index: 2;" />
					<img src="/player5_crop.png" class="tooltip" title="Right Back" id="def_4" height="100px" style="margin-left: -650px; margin-top: 440px; position: absolute; z-index: 2;" />
					<img src="/player6_crop.png" class="tooltip" title="Left Winger" id="mid_1" height="100px" style="margin-left: -350px; margin-top: 50px; position: absolute; z-index: 2;" />
					<img src="/player7_crop.png" class="tooltip" title="Central Midfielder" id="mid_2" height="100px" style="margin-left: -350px; margin-top: 180px; position: absolute; z-index: 2;" />
					<img src="/player8_crop.png" class="tooltip" title="Central Midfielder" id="mid_3" height="100px" style="margin-left: -350px; margin-top: 310px; position: absolute; z-index: 2;" />
					<img src="/player9_crop.png" class="tooltip" title="Right Winger" id="mid_4" height="100px" style="margin-left: -350px; margin-top: 440px; position: absolute; z-index: 2;" />
					<img src="/player10_crop.png" class="tooltip" title="Striker" id="sk_1" height="100px" style="margin-left: -160px; margin-top: 180px; position: absolute; z-index: 2;" />
					<img src="/player11_crop.png" class="tooltip" title="Assisting Attacker" id="sk_2" height="100px" style="margin-left: -160px; margin-top: 310px; position: absolute; z-index: 2;" />
					<div id="legend_title" style="margin-left: 370px; margin-top: -680px; position: absolute; z-index: 2; font-size: 25px; font-weight: bold">" "</div>
					<svg id="legendLinear" width="100%" style="margin-left: -820px; margin-top: -40px; position: absolute; z-index: 2;"></svg>
					<br>
					<img src="/1.png" class="tooltip" title="England" height="50px" style="margin-left: -20px; margin-top: -20px; position: relative; z-index: 2;"/>
					<img src="/2.png" class="tooltip" title="Spain" height="50px" style="margin-left: 110px; margin-top: -20px; position: relative; z-index: 2;"/>
					<img src="/3.png" class="tooltip" title="Brazil" height="50px" style="margin-left: 110px; margin-top: -20px; position: relative; z-index: 2;"/>
					<img src="/4.png" class="tooltip" title="Argentina" height="50px" style="margin-left: 105px; margin-top: -20px; position: relative; z-index: 2;"/>
					<img src="/5.png" class="tooltip" title="France" height="50px" style="margin-left: 100px; margin-top: -20px; position: relative; z-index: 2;"/>
					<img src="/6.png" class="tooltip" title="Portugal" height="52.5px" style="margin-left: 107px; margin-top: -22px; position: absolute; z-index: 2;"/>

					<div id="country_bar"></div>
					<div>You selected the country:
						<br>
					<span id="country-value" style="font-size: 25px; font-weight: bold;"></span>
					</div>
					<div id="age_bar" style="position: absolute; z-index: 2;"></div>
					<div id="wage_bar" style="position: absolute; z-index: 2;"></div>

					<div id="age_caption" style="margin-left: -140px; margin-top: -680px; position: absolute; z-index: 2; font-size: 25px; font-weight: bold"> Age </div>
					<div id="wage_caption" style="margin-left: -150px; margin-top: -120px; position: absolute; z-index: 2; font-size: 25px; font-weight: bold"> Wage </div>


					<a class="button" style="margin-left: 890px;
														margin-top: -590px;
														position: absolute;
														z-index: 2;
														min-width: 5em;"
														onclick="display_ratings()">Ratings</a>

					<a class="button" style="margin-left: 890px;
														margin-top: -420px;
														position: absolute;
														z-index: 2;
														min-width: 5em"
														onclick="display_strength()">Strength</a>

					<a class="button" style="margin-left: 890px;
														margin-top: -270px;
														min-width: 5em;
														position: absolute;
														z-index: 2;"
														onclick="display_stamina()">Stamina</a>
				</div>
				<!-- <footer class="major container 75%">
					<h3>Tableau Visualization</h3>
					<p>We attempt to display the world map of FIFA players.</p>
					<ul class="actions">
						<li><a href="#" class="button">Tableau Story 1</a></li>
						<li><a href="#" class="button">Tableau Story 2</a></li>
					</ul>
				</footer> -->

			</div>

		<!-- Footer -->
			<div id="footer">
				<div class="container 75%">

					<header class="major last">
						<h2>Designed by Toan Luong and Hemant Jain</h2>
					</header>
					<form method="post" action="#">
						<div class="row">
							<div class="6u 12u(mobilep)">
								<input type="text" name="name" placeholder="Name" />
							</div>
							<div class="6u 12u(mobilep)">
								<input type="email" name="email" placeholder="Email" />
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<textarea name="message" placeholder="Message" rows="6"></textarea>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<ul class="actions">
									<li><input type="submit" value="Send Feedback" /></li>
								</ul>
							</div>
						</div>
					</form>

					<ul class="icons">
						<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
					</ul>

					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>

				</div>
			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script src="assets/js/jquery/jquery-ui.js"></script>
			<script src="assets/js/nouislider.min.js"></script>
			<script src="assets/js/wNumb.js"></script>
			<script src="https://d3js.org/d3.v4.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.0/d3-legend.js"></script>
			<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
			<script src="assets/js/tooltipster-master/dist/js/tooltipster.bundle.min.js"></script>
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		</body>
<script>
	// Country Bar
	var country_bar = document.getElementById('country_bar');
	var CountryValueElement = document.getElementById('country-value');
	country_bar.style.width = '850px';
	noUiSlider.create(country_bar, {
		start: [0],
		range: {
			'min': [0],
			'20%': [1],
			'40%': [2],
			'60%': [3],
			'80%': [4],
			'max': [5]
		},
		snap: true,
	});

	country_bar.noUiSlider.on('update', function( values, handle ) {
		var lookupValues = ["England", "Spain", "Brazil", "Argentina", "France", "Portugal"];
		CountryValueElement.innerHTML = lookupValues[parseInt(values[handle])];
	});

	// Age Bar
	var age_bar = document.getElementById('age_bar');
	age_bar.style.height = '200px';
	age_bar.style.margin = '-620px -130px';
	noUiSlider.create(age_bar, {
		start: [15, 45],
		connect: true, // Display a colored bar between the handles
		direction: 'rtl', // Put '0' at the bottom of the slider
		orientation: 'vertical', // Orient the slider vertically
		behaviour: 'tap-drag', // Move handle on tap, bar is draggable
		step: 1,
		tooltips: true,
		format: wNumb({
			decimals: 0,
			mark: '.',
			thousand: ',',
		}),
		range: {
			'min': 15,
			'max': 45
		},
	});

	// Wage Bar
	var wage_bar = document.getElementById('wage_bar');

	wage_bar.style.height = '200px';
	wage_bar.style.margin = '-350px -130px';

	noUiSlider.create(wage_bar, {
		start: [1, 100],
		connect: true, // Display a colored bar between the handles
		direction: 'rtl', // Put '0' at the bottom of the slider
		orientation: 'vertical', // Orient the slider vertically
		behaviour: 'tap-drag', // Move handle on tap, bar is draggable
		step: 1,
		tooltips: true,
		format: wNumb({
			decimals: 0,
			mark: '.',
			thousand: ',',
			prefix: 'â‚¬ ',
			suffix: ' m'
		}),
		range: {
			'min': 1,
			'max': 100
		},
	});

	function display_stamina(){
		var lookupValues = ["England", "Spain", "Brazil", "Argentina", "France", "Portugal"];
		var country_code = country_bar.noUiSlider.get(); // [0 to 5]
		var country = lookupValues[parseInt(country_code)];
		var wage =  wage_bar.noUiSlider.get();
		var age = age_bar.noUiSlider.get();
		var wage_min = wage[0].split(" ")[1];
		var wage_max = wage[1].split(" ")[1];
		var age_min = age[0];
		var age_max = age[1];
		console.log(country, wage_min, wage_max, age_min, age_max)
		location.href = "http://localhost:8080" + "?country=" + country + "&atb=Stamina&wage_min=" + wage_min + "&wage_max=" + wage_max + "&age_min=" + age_min + "&age_max=" + age_max;
	}
	function display_ratings(){
		var lookupValues = ["England", "Spain", "Brazil", "Argentina", "France", "Portugal"];
		var country_code = country_bar.noUiSlider.get(); // [0 to 5]
		var country = lookupValues[parseInt(country_code)];
		var wage =  wage_bar.noUiSlider.get();
		var age = age_bar.noUiSlider.get();
		var wage_min = wage[0].split(" ")[1];
		var wage_max = wage[1].split(" ")[1];
		var age_min = age[0];
		var age_max = age[1];
		console.log(country, wage_min, wage_max, age_min, age_max)
		location.href = "http://localhost:8080" + "?country=" + country + "&atb=Overall&wage_min=" + wage_min + "&wage_max=" + wage_max + "&age_min=" + age_min + "&age_max=" + age_max;
	}
	function display_strength(){
		var lookupValues = ["England", "Spain", "Brazil", "Argentina", "France", "Portugal"];
		var country_code = country_bar.noUiSlider.get(); // [0 to 5]
		var country = lookupValues[parseInt(country_code)];
		var wage =  wage_bar.noUiSlider.get();
		var age = age_bar.noUiSlider.get();
		var wage_min = wage[0].split(" ")[1];
		var wage_max = wage[1].split(" ")[1];
		var age_min = age[0];
		var age_max = age[1];
		console.log(country, wage_min, wage_max, age_min, age_max)
		location.href = "http://localhost:8080" + "?country=" + country + "&atb=Strength&wage_min=" + wage_min + "&wage_max=" + wage_max + "&age_min=" + age_min + "&age_max=" + age_max;
	}

	// Color Legend
	var grad_min = 0;
	var grad_max = 0;
	var player_stats;
	function getData(file)
	{
	    var rawFile = new XMLHttpRequest();
	    rawFile.open("GET", file, false);
	    rawFile.onreadystatechange = function ()
	    {
	        if(rawFile.readyState === 4)
	        {
	            if(rawFile.status === 200 || rawFile.status == 0)
	            {
	                var allText = rawFile.responseText;
					var arr = allText.split('\n');
					grad_min = parseInt(arr[0])
					grad_max = parseInt(arr[1])
					player_stats = arr
	            }
	        }
	    }
	    rawFile.send(null);
	}
	getData("/color_domain.txt");
	console.log(grad_min, grad_max, player_stats);

	var linear = d3.scaleLinear()
	  .domain([grad_min, grad_max])
	  .range(["rgb(220, 0, 220)", "rgb(60, 0, 60)"]);

	var svg = d3.select("svg");

	svg.append("g")
	  .attr("id", "legendLinear")
	  .attr("transform", "translate(20,10)");

	var legendLinear = d3.legendColor()
	  .shapeWidth(60)
	  .cells(10)
	  .orient('horizontal')
	  .scale(linear);

	svg.select("#legendLinear")
	  .call(legendLinear);

	function loadQueryString(){
	    var parameters = {};
	    var searchString = location.search.substr(1);
	    var pairs = searchString.split("&");
	    var parts;
	    for(i = 0; i < pairs.length; i++){
	        parts = pairs[i].split("=");
	        var name = parts[0];
	        var data = decodeURI(parts[1]);
	        parameters[name] = data;
	    }
	    return parameters;
	}
	params = loadQueryString();
	console.log(params)
	var lookupValues = ["England", "Spain", "Brazil", "Argentina", "France", "Portugal"];
	wage_bar.noUiSlider.updateOptions({
	    start: [params['wage_min'], params['wage_max']]
	}, true);
	age_bar.noUiSlider.updateOptions({
	    start: [params['age_min'], params['age_max']]
	}, true);
	country_bar.noUiSlider.updateOptions({
	    start: [parseInt(lookupValues.indexOf(params['country']))]
	}, true);
	if (params['atb'] == "Overall") {
		document.getElementById("legend_title").innerHTML = "Rating";
	}
	else {
		document.getElementById("legend_title").innerHTML = params['atb'];
	}

	$(document).ready(function () {
	    $('.tooltip').tooltipster({
	    	theme: 'tooltipster-noir',
	        position: 'right'
	    });
	});

	var gk = document.getElementById('gk');
	gk.title = "Average Goalkeeper " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[2];
	var def_1 = document.getElementById('def_1');
	def_1.title = "Average Left Back " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[3];
	var def_2 = document.getElementById('def_2');
	def_2.title = "Average Left Center Back " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[4];
	var def_3 = document.getElementById('def_3');
	def_3.title = "Average Right Center Back " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[5];
	var def_4 = document.getElementById('def_4');
	def_4.title = "Average Right Back " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[6];

	var mid_1 = document.getElementById('mid_1');
	mid_1.title = "Average Left Winger " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[7];
	var mid_2 = document.getElementById('mid_2');
	mid_2.title = "Average Left Midfielder " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[8];
	var mid_3 = document.getElementById('mid_3');
	mid_3.title = "Average Right Midfielder " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[9];
	var mid_4 = document.getElementById('mid_4');
	mid_4.title = "Average Right Winger " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[10];

	var sk_1 = document.getElementById('sk_1');
	sk_1.title = "Average Striker " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[11];
	var sk_2 = document.getElementById('sk_2');
	sk_2.title = "Average Assisting Striker " + document.getElementById("legend_title").innerHTML +" : "+ player_stats[12];

</script>
</html>
